pipeline {

    agent { label 'worker' }

    stages {
       stage('Print Node Name') {
            steps {
                 script {
                      echo "Running on node: ${env.NODE_NAME}"
                 }
            }
        }
        stage('Assume Role') {
            steps {
                script {
                    sh 'sudo aws s3 ls'
                    ASSUME_ROLE_ARN='arn:aws:iam::175222917203:role/AmazonSSMManagedInstanceRole'
                    TEMP_ROLE = sh (
                        script: "aws sts assume-role --role-arn ${ASSUME_ROLE_ARN} --role-session-name jenkins-dev",
                        returnStdout: true
                        ).trim()
                    TEMP_ROLE = readJSON text: "${TEMP_ROLE}"
                }
            }
        }
    }
}
